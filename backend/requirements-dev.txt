# backend/requirements-dev.txt
pytest==7.4.4
pytest-asyncio==0.23.3
pytest-cov==4.1.0
black==23.12.0
flake8==7.0.0
mypy==1.8.0
bandit==1.7.6
safety>=3.7.0

sdgp code
/
okay gather knwledge from the files im Malith De Silva Founder Â· Technical Lead/yasindu
i need to do much as possible till others work is required for me to go forward .help me step by step and always refer to something with its directory ,  tell me everything , use best industrial practices

15:25
ClearDrive.lk - Malith's Ultra-Fast Setup Guide (Week 1, Day 1-7)
I'll guide you through setting up EVERYTHING you can do independently before the team needs to collaborate. Let's move fast! ðŸš€

ðŸ“… TODAY (Day 1 - Sunday, January 26): PROJECT FOUNDATION
Part 1: Project Management Setup (2 hours)
Step 1.1: Create Jira Project (30 min)
bash
# Go to: https://jira.atlassian.com
# Sign up with: malith@cleardrive.lk

1. Create new project â†’ Scrum template
2. Project name: ClearDrive.lk
3. Project key: CD
4. Add team members:
   - lehan@cleardrive.lk (Frontend Lead)
   - tharin@cleardrive.lk (Orders/Payments)
   - pavara@cleardrive.lk (KYC/AI)
   - parindra@cleardrive.lk (Vehicles/Security Docs)
   - kalidu@cleardrive.lk (Shipping/GDPR)
Step 1.2: Configure Jira Board (30 min)
bash
Settings â†’ Board Settings:

Columns: 
  To Do â†’ In Progress â†’ Code Review â†’ Testing â†’ Done

Swimlanes: 
  Group by: Assignee

Custom Fields (Settings â†’ Fields â†’ Custom Fields):
  1. Security Impact (Dropdown)
     - Critical, High, Medium, Low, None
  
  2. Module (Select List)
     - Authentication, Vehicles, Orders, Payments, KYC, 
       Shipping, Admin, Frontend, Mobile, DevOps, Security, GDPR
  
  3. Acceptance Criteria (Paragraph text)
Step 1.3: Create Epics (30 min)
bash
Backlog â†’ Create â†’ Epic

Copy from: documents/ClearDrive.lk jira.md (lines 52-67)

Epic ID | Epic Name                        | Owner
--------|----------------------------------|----------
CD-E1   | Project Foundation & DevOps      | Malith
CD-E2   | Authentication & Authorization   | Malith
CD-E7   | Admin Dashboard                  | Malith
CD-E10  | Security Hardening              | Malith

# Add these 4 epics for now - you'll add others when team joins
Step 1.4: Create GitHub Organization (30 min)
bash
# Go to: https://github.com/new
# Create organization: cleardrive-lk

# Create repository:
Repository name: cleardrive
Description: ClearDrive.lk - Vehicle Import Platform
Visibility: Private
Initialize: README, .gitignore (Python), MIT License

# Invite team members (can do later when they join)
Part 2: Monorepo Structure Setup (2 hours)
Step 2.1: Clone & Setup Monorepo (1 hour)
bash
# Clone repository
cd ~/projects
git clone git@github.com:cleardrive-lk/cleardrive.git
cd cleardrive

# Create monorepo structure
mkdir -p backend/app/{core,middleware,modules,tests}
mkdir -p apps/{web,mobile}
mkdir -p packages/shared/{api,services,types,validation,utils}
mkdir -p docs
mkdir -p scripts
mkdir -p .github/workflows

# Create directory structure
cat > .directory-structure.txt << 'EOF'
cleardrive/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ core/              # Shared infrastructure
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”‚   â”œâ”€â”€ database.py
â”‚   â”‚   â”‚   â”œâ”€â”€ security.py
â”‚   â”‚   â”‚   â”œâ”€â”€ dependencies.py
â”‚   â”‚   â”‚   â”œâ”€â”€ permissions.py
â”‚   â”‚   â”‚   â”œâ”€â”€ rate_limit.py
â”‚   â”‚   â”‚   â””â”€â”€ integrity.py
â”‚   â”‚   â”œâ”€â”€ middleware/         # Security middleware
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â””â”€â”€ security_headers.py
â”‚   â”‚   â”œâ”€â”€ modules/            # Domain modules
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ vehicles/
â”‚   â”‚   â”‚   â”œâ”€â”€ orders/
â”‚   â”‚   â”‚   â”œâ”€â”€ kyc/
â”‚   â”‚   â”‚   â”œâ”€â”€ payments/
â”‚   â”‚   â”‚   â”œâ”€â”€ finance/
â”‚   â”‚   â”‚   â”œâ”€â”€ insurance/
â”‚   â”‚   â”‚   â”œâ”€â”€ lc/
â”‚   â”‚   â”‚   â”œâ”€â”€ customs/
â”‚   â”‚   â”‚   â”œâ”€â”€ shipping/
â”‚   â”‚   â”‚   â”œâ”€â”€ admin/
â”‚   â”‚   â”‚   â”œâ”€â”€ notifications/
â”‚   â”‚   â”‚   â””â”€â”€ gdpr/
â”‚   â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ conftest.py
â”‚   â”‚   â”‚   â”œâ”€â”€ test_auth.py
â”‚   â”‚   â”‚   â””â”€â”€ security/
â”‚   â”‚   â””â”€â”€ main.py
â”‚   â”œâ”€â”€ alembic/
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ requirements-dev.txt
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ pytest.ini
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/                    # Next.js Web App
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ middleware.ts
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ next.config.js
â”‚   â””â”€â”€ mobile/                 # React Native + Expo
â”‚       â”œâ”€â”€ app/
â”‚       â”œâ”€â”€ components/
â”‚       â”œâ”€â”€ security/
â”‚       â”œâ”€â”€ app.json
â”‚       â”œâ”€â”€ eas.json
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ shared/                 # Shared business logic
â”‚       â”œâ”€â”€ api/
â”‚       â”œâ”€â”€ services/
â”‚       â”œâ”€â”€ types/
â”‚       â”œâ”€â”€ validation/
â”‚       â”œâ”€â”€ utils/
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ tsconfig.json
â”œâ”€â”€ docs/
â”œâ”€â”€ scripts/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
EOF
Step 2.2: Backend Foundation Files (1 hour)
backend/requirements.txt

python
# backend/requirements.txt
fastapi[all]==0.109.0
uvicorn[standard]==0.27.0
sqlalchemy==2.0.25
alembic==1.13.1
psycopg2-binary==2.9.9
pydantic==2.5.3
pydantic-settings==2.1.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
redis==5.0.1
python-magic==0.4.27
cryptography==42.0.0
anthropic==0.8.1
httpx==0.26.0
python-dotenv==1.0.0
backend/requirements-dev.txt

python
# backend/requirements-dev.txt
pytest==7.4.4
pytest-asyncio==0.23.3
pytest-cov==4.1.0
black==24.1.1
flake8==7.0.0
mypy==1.8.0
bandit==1.7.6
safety==2.3.5
backend/.env.example

bash
# backend/.env.example

# Database
DATABASE_URL=postgresql://postgres:postgres@localhost:5432/cleardrive
DATABASE_SSL_MODE=disable  # require in production

# Redis
REDIS_URL=redis://localhost:6379/0

# JWT
JWT_SECRET_KEY=your-secret-key-here-min-32-chars-CHANGE-IN-PRODUCTION
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
REFRESH_TOKEN_EXPIRE_DAYS=30

# Encryption
ENCRYPTION_KEY=your-fernet-key-here-GENERATE-WITH-cryptography.fernet.Fernet.generate_key()

# Google OAuth
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# PayHere
PAYHERE_MERCHANT_ID=your-merchant-id
PAYHERE_MERCHANT_SECRET=your-merchant-secret
PAYHERE_SANDBOX=true

# Claude API
ANTHROPIC_API_KEY=sk-ant-your-api-key

# Supabase Storage
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-supabase-anon-key

# Email (SMTP)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your-email@gmail.com
SMTP_PASSWORD=your-app-password

# Sentry
SENTRY_DSN=https://your-sentry-dsn

# Admin
ADMIN_EMAILS=malith@cleardrive.lk,admin@cleardrive.lk

# Security
CLOUDFLARE_API_KEY=your-cf-api-key
SECURITY_EVENT_RETENTION_DAYS=30
MAX_FAILED_AUTH_ATTEMPTS=5

# Environment
ENVIRONMENT=development
backend/app/core/config.py

python
# backend/app/core/config.py

from pydantic_settings import BaseSettings
from typing import List


class Settings(BaseSettings):
    """Application configuration."""
    
    # App
    PROJECT_NAME: str = "ClearDrive.lk API"
    VERSION: str = "2.1.0"
    API_V1_PREFIX: str = "/api/v1"
    ENVIRONMENT: str = "development"
    
    # Database
    DATABASE_URL: str
    DATABASE_SSL_MODE: str = "disable"
    
    # Redis
    REDIS_URL: str
    
    # JWT
    JWT_SECRET_KEY: str
    JWT_ALGORITHM: str = "HS256"
    ACCESS_TOKEN_EXPIRE_MINUTES: int = 30
    REFRESH_TOKEN_EXPIRE_DAYS: int = 30
    
    # Encryption
    ENCRYPTION_KEY: str
    
    # Google OAuth
    GOOGLE_CLIENT_ID: str
    GOOGLE_CLIENT_SECRET: str
    
    # PayHere
    PAYHERE_MERCHANT_ID: str
    PAYHERE_MERCHANT_SECRET: str
    PAYHERE_SANDBOX: bool = True
    
    # Claude API
    ANTHROPIC_API_KEY: str
    
    # Supabase
    SUPABASE_URL: str
    SUPABASE_KEY: str
    
    # Email
    SMTP_HOST: str
    SMTP_PORT: int = 587
    SMTP_USERNAME: str
    SMTP_PASSWORD: str
    
    # Sentry
    SENTRY_DSN: str | None = None
    
    # Admin
    ADMIN_EMAILS: str  # Comma-separated
    
    # Security
    CLOUDFLARE_API_KEY: str | None = None
    SECURITY_EVENT_RETENTION_DAYS: int = 30
    MAX_FAILED_AUTH_ATTEMPTS: int = 5
    
    # CORS
    BACKEND_CORS_ORIGINS: List[str] = [
        "http://localhost:3000",  # Next.js dev
        "http://localhost:19006",  # Expo dev
    ]
    
    class Config:
        env_file = ".env"
        case_sensitive = True


settings = Settings()
backend/app/core/database.py

python
# backend/app/core/database.py

from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
from .config import settings

# Create engine
engine = create_engine(
    settings.DATABASE_URL,
    pool_pre_ping=True,  # Verify connections before using
    pool_size=5,
    max_overflow=10,
)

# Create session factory
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

# Create base class for models
Base = declarative_base()


def get_db():
    """
    Database session dependency.
    
    Usage:
        @router.get("/")
        async def route(db: Session = Depends(get_db)):
            ...
    """
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
backend/app/main.py

python
# backend/app/main.py

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from .core.config import settings

app = FastAPI(
    title=settings.PROJECT_NAME,
    version=settings.VERSION,
    docs_url=f"{settings.API_V1_PREFIX}/docs",
    redoc_url=f"{settings.API_V1_PREFIX}/redoc",
    openapi_url=f"{settings.API_V1_PREFIX}/openapi.json",
)

# CORS middleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=settings.BACKEND_CORS_ORIGINS,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)


@app.get("/")
async def root():
    """Root endpoint."""
    return {
        "message": "ClearDrive.lk API",
        "version": settings.VERSION,
        "docs": f"{settings.API_V1_PREFIX}/docs"
    }


@app.get("/health")
async def health_check():
    """Health check endpoint for monitoring."""
    return {
        "status": "healthy",
        "environment": settings.ENVIRONMENT,
    }


if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
Part 3: Docker Setup (1 hour)
docker-compose.yml

yaml
# docker-compose.yml

version: '3.8'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:15-alpine
    container_name: cleardrive-db
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: cleardrive
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis Cache
  redis:
    image: redis:7-alpine
    container_name: cleardrive-redis
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Backend API
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: cleardrive-backend
    command: uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
    volumes:
      - ./backend:/app
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://postgres:postgres@postgres:5432/cleardrive
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    env_file:
      - ./backend/.env

volumes:
  postgres_data:
  redis_data:
backend/Dockerfile

dockerfile
# backend/Dockerfile

FROM python:3.11-slim

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    gcc \
    postgresql-client \
    libmagic1 \
    && rm -rf /var/lib/apt/lists/*

# Install Python dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy application
COPY . .

# Expose port
EXPOSE 8000

# Run application
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000", "--reload"]
.gitignore

gitignore
# .gitignore

# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
env/
venv/
ENV/
.venv

# FastAPI
.pytest_cache/
.coverage
htmlcov/

# Database
*.db
*.sqlite3

# Environment
.env
.env.local
.env.*.local

# IDEs
.vscode/
.idea/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Logs
*.log

# Node
node_modules/
.next/
out/
build/
dist/

# Mobile
.expo/
.expo-shared/

# Misc
*.pem
Part 4: Test the Setup (30 min)
bash
# 1. Create .env file
cd backend
cp .env.example .env

# 2. Generate encryption key
python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# Copy output and paste in .env as ENCRYPTION_KEY

# 3. Generate JWT secret
python -c "import secrets; print(secrets.token_urlsafe(32))"
# Copy output and paste in .env as JWT_SECRET_KEY
